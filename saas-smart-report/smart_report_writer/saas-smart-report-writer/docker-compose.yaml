services:
  worker:
    build:
      context: .                   # repo root
      dockerfile: api/workers/Dockerfile
    depends_on:
      redis:
        condition: service_started
      minio:
        condition: service_started
      createbucket:
        condition: service_started
    environment:
      PYTHONPATH: /app:/opt/srw
      REDIS_URL: redis://redis:6379/0
      S3_ENDPOINT: http://minio:9000
      S3_BUCKET: srw-artifacts
      S3_ACCESS_KEY: minio
      S3_SECRET_KEY: minio123
      S3_REGION: us-east-1
      OLLAMA_BASE_URL: http://ollama:11434  # OR host.docker.internal:11434 if using host Ollama
      OLLAMA_MODEL: llama3.2:latest
      SRW_PER_FILE_CAP: "12000"
      SRW_TOTAL_CAP: "150000"
    volumes:
      - ./smart_report_writer:/opt/srw:delegated
      - shareddata:/shared

