services:
  api:
    build:
      context: .
      dockerfile: api/Dockerfile
    environment:
      POSTGRES_DSN: postgresql+psycopg2://postgres:postgres@db:5432/srw
      REDIS_URL: redis://redis:6379/0
      S3_ENDPOINT: http://minio:9000
      S3_REGION: us-east-1
      S3_BUCKET: srw-artifacts
      S3_ACCESS_KEY: minio
      S3_SECRET_KEY: minio123
      LLM_PROVIDER: ollama
      OLLAMA_BASE_URL: http://ollama:11434
      OLLAMA_MODEL: llama3.2:latest
      OIDC_ISSUER: http://localhost:8000/dev-issuer
      OIDC_AUDIENCE: srw-api
      OIDC_CLIENT_ID: dev-ui
      OIDC_CLIENT_SECRET: dev-secret
    depends_on:
      db: { condition: service_started }
      redis: { condition: service_started }
      minio: { condition: service_started }
    ports:
      - "8000:8000"
