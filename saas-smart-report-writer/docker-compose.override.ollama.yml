services:
  ollama:
    image: ollama/ollama:latest
    healthcheck:
      test: ["CMD","curl","-f","http://localhost:11434/api/version"]
      interval: 10s
      timeout: 3s
      retries: 20
    # NOTE: no "ports:" so it stays internal; avoids conflicts with a host ollama
    volumes:
      - ollama:/root/.ollama

  api:
    environment:
      OLLAMA_BASE_URL: http://ollama:11434

  worker:
    environment:
      OLLAMA_BASE_URL: http://ollama:11434

volumes:
  ollama:
